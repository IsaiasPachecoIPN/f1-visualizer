<div class="app-container" [class.drawer-open]="drawerOpen() && useDrawer()">
  <header class="app-header">
    <button z-button zType="ghost" zSize="sm" class="hamburger" (click)="toggleDrawer()" *ngIf="useDrawer()">
      <span class="icon-menu text-xl"></span>
    </button>
    <h1>F1 Track Visualizer</h1>
  </header>

  <!-- Desktop / Large layout -->
  <div class="content-wrapper" *ngIf="!useDrawer(); else mobileLayout">
    <aside class="left-panel">
      <div class="info-card">
        <z-badge [ngStyle]="{margin: '10px 0'}">Drivers</z-badge>
        <app-drivers></app-drivers>
      </div>
      <div class="info-card">
        <z-badge [ngStyle]="{margin: '10px 0'}">Race Info</z-badge>
        <app-controls></app-controls>
        <app-race-info></app-race-info>
      </div>
      <div class="info-card">
        <z-badge [ngStyle]="{margin: '10px 0'}">Live Positions</z-badge>
        <app-positions></app-positions>
      </div>
    </aside>

    <main class="main-content">
      <div class="detached-hud-bar" *ngIf="hudDetach()">
        <div class="detached-session" *ngIf="(animation?.sessionName$ | async) as sessionName" [title]="sessionName">{{ sessionName }}</div>
        <div class="detached-controls">
          <button class="hud-btn" (click)="animation?.playPause()" [title]="animation?.getIsPlaying() ? 'Pause' : 'Play'">{{ animation?.getIsPlaying() ? '‚è∏' : '‚ñ∂' }}</button>
          <button class="hud-btn" (click)="animation?.restart()" title="Restart">‚Üª</button>
            <button class="hud-btn" (click)="animation?.decreaseSpeed()" title="Slower">‚àí</button>
            <div class="speed-display">{{ animation?.getSpeedMultiplier() }}x</div>
            <button class="hud-btn" (click)="animation?.increaseSpeed()" title="Faster">+</button>
            <!-- <button class="hud-btn toggle" (click)="animation && animation.animationControlService.toggleShowAllDrivers()" title="Toggle drivers">üë•</button> -->
        </div>
      </div>
      <div class="main-animation">
        <app-animation #animation></app-animation>
      </div>
      <div class="comments-section">
        <h2>Comments</h2>
        <app-comments></app-comments>
      </div>
    </main>
  </div>

  <!-- Mobile / Tablet layout -->
  <ng-template #mobileLayout>
    <div class="responsive-wrapper">
      <!-- Simulated Drawer using dialog base styles -->
      <div class="drawer-mask" *ngIf="drawerOpen()" (click)="closeDrawer()"></div>
      <div class="drawer-panel" [class.open]="drawerOpen()">
        <div class="drawer-header">
          <h3 class="drawer-title">Race Panels</h3>
          <button z-button zType="ghost" zSize="sm" (click)="closeDrawer()"><span class="icon-x"></span></button>
        </div>
        <z-accordion zType="single" [zDefaultValue]="'positions'" class="drawer-accordion">
          <z-accordion-item zTitle="Race Positions" zValue="positions">
            <app-positions></app-positions>
          </z-accordion-item>
          <z-accordion-item zTitle="Drivers" zValue="drivers">
            <app-drivers></app-drivers>
          </z-accordion-item>
          <z-accordion-item zTitle="Race Info" zValue="raceinfo">
            <app-controls></app-controls>
            <app-race-info></app-race-info>
          </z-accordion-item>
        </z-accordion>
      </div>

      <main class="main-content mobile">
        <div class="detached-hud-bar" *ngIf="hudDetach()">
          <div class="detached-session" *ngIf="(animationMob?.sessionName$ | async) as sessionName" [title]="sessionName">{{ sessionName }}</div>
          <div class="detached-controls">
            <button class="hud-btn" (click)="animationMob?.playPause()" [title]="animationMob?.getIsPlaying() ? 'Pause' : 'Play'">{{ animationMob?.getIsPlaying() ? '‚è∏' : '‚ñ∂' }}</button>
            <button class="hud-btn" (click)="animationMob?.restart()" title="Restart">‚Üª</button>
            <button class="hud-btn" (click)="animationMob?.decreaseSpeed()" title="Slower">‚àí</button>
            <div class="speed-display">{{ animationMob?.getSpeedMultiplier() }}x</div>
            <button class="hud-btn" (click)="animationMob?.increaseSpeed()" title="Faster">+</button>
            <!-- <button class="hud-btn toggle" (click)="animationMob && animationMob.animationControlService.toggleShowAllDrivers()" title="Toggle drivers">üë•</button> -->
          </div>
        </div>
        <div class="main-animation">
          <app-animation #animationMob></app-animation>
        </div>
        <z-card class="mobile-comments" zTitle="Comments">
          <app-comments></app-comments>
        </z-card>
      </main>
    </div>
  </ng-template>

  <footer class="app-footer">
    <p>&copy; 2025 Lexis Nexis - Motorsport Analytics</p>
  </footer>
</div>
<app-loading></app-loading>
<router-outlet />