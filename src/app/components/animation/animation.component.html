<div class="animation-container">
  <!-- Timer (top-left) -->
  <div class="hud-timer" *ngIf="(currentTime$ | async) as currentTime">
    {{ currentTime | date:'HH:mm:ss':'UTC' }} <span class="tz">UTC</span>
  </div>
  <!-- Lap HUD (wide screens only) -->
  <div class="hud-lap" *ngIf="(currentLapInfo$ | async) as lap">
    <div class="lap-item"><strong>Lap</strong> {{ lap.lapNumber || '?' }}</div>
    <div class="lap-item" *ngIf="lap.lapDuration as ld">Time {{ ld | number:'1.2-2' }}s</div>
    <div class="lap-item" *ngIf="lap.speedTrap as st">Trap {{ st }} km/h</div>
  </div>

  <!-- In-canvas HUD (hidden when detached HUD active via global CSS override) -->
  <div class="hud-responsive-group">
    <div class="hud-session" *ngIf="(sessionName$ | async) as sessionName" [title]="sessionName">{{ sessionName }}</div>
    <div class="hud-controls">
      <button class="hud-btn" (click)="playPause()" [title]="getIsPlaying() ? 'Pause' : 'Play'">{{ getIsPlaying() ? '‚è∏' : '‚ñ∂' }}</button>
      <button class="hud-btn" (click)="restart()" title="Restart">‚Üª</button>
      <button class="hud-btn" (click)="decreaseSpeed()" title="Slower">‚àí</button>
      <div class="speed-display">{{ getSpeedMultiplier() }}x</div>
      <button class="hud-btn" (click)="increaseSpeed()" title="Faster">+</button>
      <!-- <button class="hud-btn toggle" (click)="animationControlService.toggleShowAllDrivers()" title="Toggle drivers">üë•</button> -->
    </div>
  </div>

  <!-- Existing zoom buttons -->
  <div class="zoom-controls">
    <button type="button" (click)="zoomIn()" title="Zoom In">üîç+</button>
    <button type="button" (click)="zoomOut()" title="Zoom Out">üîç-</button>
  <button type="button" (click)="resetZoom()" title="Reset Zoom">‚åÇ</button>
  </div>
  <canvas #animationCanvas></canvas>
  
  <!-- Car Tooltip -->
  <app-car-tooltip 
    [visible]="showTooltip" 
    [x]="tooltipX" 
    [y]="tooltipY" 
    [driverData]="hoveredDriverData">
  </app-car-tooltip>
</div>

<style>
/* Responsive fill: parent (.main-animation) supplies padding/border */
.animation-container {
  position: absolute; /* occupy the padded inner box of main-animation */
  inset: 0;
  width: 100%;
  height: 100%;
  min-height: 0; /* allow flex parent control */
  overflow: hidden;
  border: none;
  border-radius: 8px; /* inherit visual boundary from parent */
}

.zoom-controls {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 10;
  display: flex;
  gap: 5px;
}

.zoom-controls button {
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 8px 12px;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.2s;
}

.zoom-controls button:hover {
  background: rgba(255, 255, 255, 1);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.zoom-controls button:active {
  transform: scale(0.95);
}

canvas {
  display: block;
  width: 100%;
  height: 100%;
  background: #f8f9fa;
  /* Avoid blurriness on resize while animation running */
  image-rendering: optimizeSpeed;
}

/* HUD additions */
.hud-timer {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.6);
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 14px;
  color: #00ff88;
  letter-spacing: 1px;
  display: flex;
  align-items: center;
  gap: 4px;
  backdrop-filter: blur(4px);
}
.hud-timer .tz { color: #fff; font-size: 12px; opacity: 0.8; }

/* Lap HUD */
.hud-lap {
  position: absolute;
  top: 10px;
  left: 160px; /* offset from timer */
  background: rgba(0,0,0,0.6);
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 500;
  color: #fff;
  display: flex;
  gap: 14px;
  align-items: center;
  backdrop-filter: blur(4px);
  letter-spacing: .5px;
}
.hud-lap .lap-item { white-space: nowrap; }

@media (max-width: 1706px) {
  .hud-lap { display: none !important; }
}

.hud-controls {
  position: absolute;
  top: 10px;
  right: 170px; /* leave space for zoom */
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(0,0,0,0.55);
  padding: 6px 10px;
  border-radius: 10px;
  backdrop-filter: blur(4px);
}

.hud-btn {
  background: rgba(255,255,255,0.9);
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px 10px;
  cursor: pointer;
  font-size: 14px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color .2s, transform .15s;
  font-family: inherit;
}
.hud-btn:hover { background: #fff; }
.hud-btn:active { transform: scale(.9); }
.hud-btn.toggle { font-size: 16px; }

.speed-display {
  min-width: 40px;
  text-align: center;
  font-weight: 600;
  color: #fff;
  font-size: 13px;
}
.hud-session {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  max-width: 50%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  background: rgba(0,0,0,0.55);
  padding: 6px 14px 6px 14px;
  border-radius: 10px;
  font-weight: 600;
  font-size: 14px;
  color: #ffffff;
  letter-spacing: .5px;
  backdrop-filter: blur(4px);
}

/* Wrapper defaults (no effect on wide screens) */
.hud-responsive-group { display: contents; }

/* Breakpoint: detach session & controls from overlay below 1706px */
/* (Former inline mode removed; detached HUD lives outside now) */
@media (max-width: 1706px) {
  .hud-session, .hud-controls { display: none !important; }
}
</style>
